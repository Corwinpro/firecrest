from firecrest.solvers.unsteady_tv_acoustic_solver import UnsteadyTVAcousticSolver
from firecrest.models.free_surface_cap import SurfaceModel, AdjointSurfaceModel
import dolfin as dolf
from collections import namedtuple
from decimal import Decimal
from firecrest.misc.time_storage import TimeSeries
from firecrest.misc.optimization_mixin import OptimizationMixin
import numpy as np
import csv

from firecrest.mesh.unit_domain import IntervalDomain, PointBoundary


p1 = PointBoundary(
    [0], inside=lambda x: x[0] < 0.1, bcond={"normal_force": None, "adiabatic": True}
)
p2 = PointBoundary(
    [1], inside=lambda x: x[0] > 0.9, bcond={"inflow": 0.0, "adiabatic": True}
)
domain = IntervalDomain([p1, p2], resolution=200)
timer = {"dt": Decimal("0.0001"), "T": Decimal("2.5")}


def resolve_mesh(mesh, iterations, cut):
    for _ in range(iterations):
        markers = dolf.MeshFunction("bool", mesh, False)
        for c in dolf.cells(mesh):
            if c.midpoint().x() > cut:
                markers[c] = True

        mesh = dolf.refine(mesh, markers)
    return mesh


# domain.mesh = resolve_mesh(domain.mesh, 1)

height = 0.7
length = 9.2
actuator_length = 4.0
offset_top = 1.0
nozzle_r = 0.1
nozzle_l = 0.2
nozzle_offset = 0.2
manifold_width = 2.0
manifold_height = 4.7

# Define constants
L = 1.0e-4
c_s = 1.0e3
rho = 1.0e3
epsilon = 1.0e-3
gamma_st = 50.0e-3
mu = 1.0e-2
Re = rho * c_s * L / mu
a1 = 4.0 / 3.0
a2 = 8
kappa_prime = epsilon / nozzle_r ** 4 * 0.25  # up to a constant

# non dimensional
alpha_1 = nozzle_l / (3.1415 * nozzle_r ** 2) * a1
alpha_2 = nozzle_l / (3.1415 * nozzle_r ** 3) / Re * a2 / nozzle_r
gamma_nd = 2 * gamma_st / (rho * c_s ** 2 * nozzle_r * epsilon)


Constants = namedtuple(
    "Constants",
    [
        "density",
        "acoustic_mach",
        "channel_L",
        "nozzle_L",
        "nozzle_R",
        "surface_tension",
        "Re",
        "sound_speed",
    ],
)
printhead_constants = Constants(rho, epsilon, L, 10.0e-6, 10.0e-6, gamma_st, Re, c_s)

nondim_constants = Constants(
    1.0,
    printhead_constants.acoustic_mach,
    1,
    printhead_constants.nozzle_L / printhead_constants.channel_L,
    printhead_constants.nozzle_R / printhead_constants.channel_L,
    2.0
    * printhead_constants.surface_tension
    / (
        printhead_constants.density
        * printhead_constants.sound_speed ** 2.0
        * printhead_constants.nozzle_R
        * printhead_constants.acoustic_mach
    ),
    printhead_constants.Re,
    1.0,
)

grad_data = {"grad_norm": None}


class NormalInflow:
    def __init__(self, series: TimeSeries):
        self.counter = 1
        self.series = list(series.values())

    def eval(self):
        if self.counter < len(self.series):
            value = self.series[self.counter]
            self.counter += 1
            return value
        return 0.0


class OptimizationSolver(OptimizationMixin, UnsteadyTVAcousticSolver):
    def flow_rate(self, state):
        return dolf.assemble(
            dolf.inner(state[1], self.domain.n) * self.domain.ds((p1.surface_index,))
        )

    def _objective_state(self, control):
        p2.bcond["inflow"] = NormalInflow(
            TimeSeries.from_list([0.0] + list(control) + [0.0], default_grid)
        )

        surface_model = SurfaceModel(nondim_constants, kappa_t0=0.05)
        p1.bcond["normal_force"] = surface_model

        counter = 0
        _old_flow_rate = 0
        for state in self.solve_direct(
            initial_state, verbose=False, yield_state=True, plot_every=10000000
        ):
            # with open("energy_25.dat", "a") as file:
            #     _str = (
            #         str(self.forms.energy(state))
            #         + " "
            #         + str(surface_model.surface_energy())
            #     )
            #     file.write(_str)
            #     file.write("\n")

            _new_flow_rate = self.flow_rate(state)
            surface_model.update_curvature(
                0.5 * (_new_flow_rate + _old_flow_rate), self._dt
            )
            _old_flow_rate = _new_flow_rate

            # if counter % 10 == 0:
            #
            #     with open("unsteady_1d.dat", "a") as file:
            #         employee_writer = csv.writer(file, delimiter=",")
            #         employee_writer.writerow(
            #             [state[1](x / 1000.0) for x in range(1000)]
            #         )
            #
            # counter += 1
        with open("1d_finetime_log.dat", "a") as file:
            file.write(
                str(self._objective((state, surface_model), verbose=False))
                + "  "
                + str(surface_model.kappa)
                + ":\t"
            )
            for c in control:
                file.write(str(c) + ",")
            file.write("\n")

        return state, surface_model

    def _objective(self, state, verbose=True):
        if verbose:
            print(
                "evaluated at: ",
                self.forms.energy(state[0]) + state[1].surface_energy(state[1].kappa),
                " curvature: ",
                state[1].kappa,
            )
        return self.forms.energy(state[0]) + state[1].surface_energy(state[1].kappa)

    def boundary_averaged_stress(self, adjoint_state):
        stress = self.forms.stress(adjoint_state[0], adjoint_state[1])
        stress = dolf.assemble(
            dolf.dot(dolf.dot(stress, self.domain.n), self.domain.n)
            * self.domain.ds((p2.surface_index,))
        )
        return stress

    def _jacobian(self, state):
        state, surface_model = state
        state = (state[0], -state[1], state[2])

        adjoint_surface = AdjointSurfaceModel(direct_surface=surface_model)
        p1.bcond["normal_force"] = adjoint_surface
        adjoint_stress_averaged = midpoint_grid
        current_time = self.timer["T"] - self.timer["dt"] / Decimal("2")

        _old_flow_rate = 0
        _new_flow_rate = 0
        adjoint_surface.update_curvature(
            0.5 * (_new_flow_rate + _old_flow_rate), self._dt
        )
        for adjoint_state in solver.solve_adjoint(
            initial_state=state, verbose=False, yield_state=True, plot_every=1000000
        ):
            _old_flow_rate = _new_flow_rate
            _new_flow_rate = self.flow_rate(adjoint_state)
            adjoint_surface.update_curvature(
                0.5 * (_new_flow_rate + _old_flow_rate), self._dt
            )

            adjoint_stress_averaged[current_time] = self.boundary_averaged_stress(
                adjoint_state
            )
            # with open("jacobian_25.dat", "a") as file:
            #     _str = str(adjoint_stress_averaged[current_time])
            #     file.write(_str)
            #     file.write("\n")
            current_time -= self.timer["dt"]

        du = TimeSeries.interpolate_to_keys(adjoint_stress_averaged, small_grid)
        du[Decimal("0")] = 0.0
        du[self.timer["T"]] = 0.0

        print("gradient norm: ", (adjoint_stress_averaged * du).integrate())
        if grad_data["grad_norm"] is None:
            grad_data["grad_norm"] = (adjoint_stress_averaged * du).integrate()

        return np.array(du.values()[1:-1])


default_grid = TimeSeries.from_dict(
    {
        Decimal(k) * Decimal(timer["dt"]): 0
        for k in range(int(timer["T"] / Decimal(timer["dt"])) + 1)
    }
)
small_grid = TimeSeries.from_dict(
    {
        Decimal(k) * Decimal(timer["dt"]): 0
        for k in range(1, int(timer["T"] / Decimal(timer["dt"])))
    }
)
midpoint_grid = TimeSeries.from_dict(
    {
        Decimal(k + 0.5) * Decimal(timer["dt"]): 0
        for k in range(int(timer["T"] / Decimal(timer["dt"])) - 1)
    }
)

surface_model = SurfaceModel(nondim_constants, kappa_t0=0.05)
solver = OptimizationSolver(domain, Re=5.0e3, Pr=10.0, timer=timer)
initial_state = (0.0, 0.0, 0.0)
# initial_state = (dolf.Expression("0.1*x[0]*(1.0-x[0])", degree=2), 0.0, 0.0)


x0 = [0.0e-0 for _ in range(len(default_grid) - 2)]
top_bound = [0.06 for i in range(len(x0))]
low_bound = [-0.03 for i in range(len(x0))]
bnds = list(zip(low_bound, top_bound))
# x0 = [
#     0.053166836524232944,
#     0.05314320344046289,
#     0.053119585013473435,
#     0.05309599142999675,
#     0.05307243534730951,
#     0.05304892979378883,
#     0.053025490251256545,
#     0.05300213240664775,
#     0.05297887424795226,
#     0.0529557337764938,
#     0.05293273101725661,
#     0.052909885742011095,
#     0.05241339169795441,
#     0.05192609528111242,
#     0.05144838128501256,
#     0.05098060761466414,
#     0.05052310725622988,
#     0.050076185935378055,
#     0.04964012307949599,
#     0.04921516983885208,
#     0.04880155063597195,
#     0.04839946103890941,
#     0.048009069295737616,
#     0.04763051488271837,
#     0.04726391076309613,
#     0.0469093411428092,
#     0.046566864218470644,
#     0.046236510436952,
#     0.04591828516398294,
#     0.0456121672056409,
#     0.04531811169921532,
#     0.04503604863527996,
#     0.04476588613034216,
#     0.0445075089023268,
#     0.04426078180653416,
#     0.04402554825506982,
#     0.04380163371304685,
#     0.04358884489951502,
#     0.04338697264318565,
#     0.04319579109124794,
#     0.043015061067623525,
#     0.04284452929798291,
#     0.04268393189643258,
#     0.04253299264658734,
#     0.0423914275452225,
#     0.042258943038002914,
#     0.042135239500937005,
#     0.04202001071105923,
#     0.0419129467786399,
#     0.04181373309626901,
#     0.041722053652003405,
#     0.04163759009390928,
#     0.04156002516133572,
#     0.04148904093529655,
#     0.04142432221336757,
#     0.0413655554689899,
#     0.0413124316391445,
#     0.041264644681099076,
#     0.04122189464273091,
#     0.04118388651025762,
#     0.041150332350631404,
#     0.041120950355529415,
#     0.04109546717048824,
#     0.041073616319899,
#     0.04105514075309209,
#     0.041039791347533966,
#     0.04102732907748991,
#     0.04101752307539101,
#     0.04101015316625241,
#     0.04100500797522801,
#     0.04100188703423502,
#     0.04100059865195628,
#     0.041000962234782404,
#     0.04100280591452929,
#     0.04100596902271478,
#     0.04101029936564965,
#     0.04101565558026308,
#     0.04102190466099693,
#     0.04102892407804652,
#     0.041036599164640135,
#     0.04104482550688045,
#     0.04105350593077092,
#     0.04106255278871565,
#     0.04107188521050252,
#     0.041081431385383255,
#     0.0410911257770843,
#     0.04110091080183034,
#     0.041110734575255534,
#     0.0411205529838879,
#     0.04113032655677806,
#     0.04114002309516952,
#     0.0411496139405407,
#     0.041159077046807976,
#     0.04116839407628561,
#     0.04117755187441316,
#     0.0411865403101503,
#     0.041195354128210813,
#     0.041203990173969904,
#     0.04121244883829815,
#     0.04122073252687548,
#     0.041228847434542006,
#     0.04123679988034637,
#     0.04124459942200477,
#     0.04125225607594818,
#     0.04125978140283634,
#     0.041267186822573194,
#     0.04127448582410349,
#     0.04128169073300991,
#     0.04128881452958678,
#     0.04129586981010663,
#     0.04130286849835722,
#     0.04130982148164045,
#     0.04131673944367088,
#     0.04132363133591607,
#     0.041330505995852015,
#     0.04133736884967982,
#     0.04134422661796096,
#     0.04135108268531959,
#     0.041357939483796076,
#     0.04136479695369982,
#     0.041371654893058836,
#     0.04137851005392593,
#     0.04138535888240344,
#     0.041392194713542614,
#     0.041399011262994674,
#     0.04140579979778454,
#     0.041412551674323284,
#     0.041419254627522634,
#     0.041425897681721086,
#     0.04143246778153771,
#     0.04143895241365439,
#     0.04144533782606277,
#     0.04145160992258995,
#     0.04145775450868316,
#     0.04146375759973292,
#     0.04146960386932275,
#     0.04147528065346865,
#     0.04148077388827738,
#     0.041486071355178164,
#     0.041491160019446534,
#     0.041496029379694835,
#     0.04150066779323302,
#     0.04150506624268564,
#     0.04150921613704339,
#     0.04151311056888697,
#     0.041516742546320165,
#     0.04152010708177507,
#     0.041523199803893705,
#     0.04152601849868076,
#     0.04152856037636167,
#     0.04153082502923991,
#     0.041532812510838214,
#     0.041534525270898036,
#     0.041535964278928375,
#     0.04153713354279746,
#     0.04153803652362961,
#     0.04153867874648057,
#     0.04153906517746557,
#     0.041539202822054755,
#     0.04153909804948976,
#     0.0415387592383253,
#     0.04153819361229941,
#     0.04153741121993805,
#     0.04153642046921585,
#     0.04153523194865947,
#     0.04153385534284179,
#     0.04153230234174304,
#     0.04153058336399491,
#     0.041528710558839735,
#     0.04152669576277227,
#     0.04152455249950974,
#     0.041522292581563924,
#     0.041519930262680305,
#     0.04151747804509004,
#     0.0415149505224502,
#     0.04151236094119326,
#     0.04150972447310487,
#     0.041507054267114096,
#     0.04150436536190932,
#     0.04150167120399855,
#     0.0414989864625749,
#     0.04149632394373817,
#     0.04149369759412719,
#     0.04149111940348825,
#     0.041488602357553146,
#     0.04148615722030956,
#     0.04148379547331662,
#     0.04148152620325236,
#     0.041479358994067045,
#     0.04147730094832422,
#     0.041475359717056376,
#     0.041473540227895046,
#     0.041471847735165754,
#     0.04147028487815291,
#     0.041468854583273575,
#     0.041467556975323346,
#     0.04146639281006431,
#     0.041465360044093444,
#     0.041464457106071925,
#     0.04146368009956357,
#     0.04146302581028375,
#     0.041462488374276504,
#     0.04146206310689636,
#     0.04146174294192716,
#     0.04146152199892437,
#     0.04146139260692484,
#     0.04146134825475675,
#     0.041461380728582034,
#     0.041461483881558986,
#     0.041461649623353455,
#     0.041461871894318186,
#     0.041462143365811124,
#     0.041462458974952654,
#     0.04146281214250678,
#     0.04146319918223979,
#     0.041463615276015206,
#     0.04146405813872995,
#     0.04146452409780679,
#     0.04146501276399614,
#     0.041465522491640525,
#     0.04146605416712227,
#     0.04146660847948451,
#     0.04146718761944259,
#     0.041467793698751865,
#     0.04146843079214285,
#     0.041469101971674416,
#     0.04146981283764709,
#     0.04147056705748214,
#     0.04147137060010226,
#     0.04147222821331799,
#     0.04147314593742839,
#     0.041474128171482376,
#     0.04147518076958304,
#     0.041476307787031846,
#     0.04147751391818281,
#     0.04147880190856869,
#     0.04148017519308281,
#     0.04148163485329201,
#     0.04148318238392429,
#     0.04148481673610961,
#     0.04148653736471945,
#     0.04148834106649117,
#     0.04149022411593095,
#     0.04149218032388058,
#     0.04149420407541457,
#     0.041496286343036454,
#     0.0414984188542698,
#     0.04150058993787881,
#     0.041502788666005735,
#     0.04150500146667511,
#     0.04150721514113841,
#     0.04150941397140072,
#     0.04151158398146911,
#     0.04151370847174794,
#     0.041515772266955714,
#     0.041517758812863494,
#     0.04151965272575098,
#     0.04152143805209851,
#     0.04152310126876226,
#     0.04152462785115263,
#     0.04152600640843011,
#     0.041527225111058295,
#     0.04152827601457805,
#     0.041529151023780964,
#     0.04152984581478534,
#     0.041530356335775294,
#     0.04153068249592594,
#     0.04153082508709935,
#     0.041530788224035095,
#     0.04153057704272349,
#     0.04153020058940514,
#     0.04152966738553432,
#     0.04152899009404423,
#     0.041528180395097,
#     0.041527253977124104,
#     0.04152622533119859,
#     0.04152511209378629,
#     0.041523929316735306,
#     0.04152269527744304,
#     0.04152142587354018,
#     0.04152013872551509,
#     0.041518849452160514,
#     0.04151757486447548,
#     0.04151632858756783,
#     0.04151512526757688,
#     0.04151397677101267,
#     0.04151289513788485,
#     0.041511890052708646,
#     0.04151097198168373,
#     0.041510147186872605,
#     0.04150942337449758,
#     0.041508805501814516,
#     0.04150829847695504,
#     0.04150790497496746,
#     0.04150762833422075,
#     0.0415074687738611,
#     0.04150742847545316,
#     0.041507506570103755,
#     0.041507703620602326,
#     0.04150801696418347,
#     0.04150844699208878,
#     0.041508989958167986,
#     0.04150964464452614,
#     0.04151040712811843,
#     0.04151127484235409,
#     0.04151224270356256,
#     0.041513307864989586,
#     0.041514463758264036,
#     0.04151570591698381,
#     0.0415170268580468,
#     0.0415184205220399,
#     0.041519877557086096,
#     0.04152139051920608,
#     0.04152294867225176,
#     0.04152454242801196,
#     0.041526158958257245,
#     0.041527786976036596,
#     0.04152941175497363,
#     0.04153102015677228,
#     0.04153259610387499,
#     0.04153412475914291,
#     0.041535588494170356,
#     0.04153697174989233,
#     0.041538256108496624,
#     0.04153942499397683,
#     0.041540459663786534,
#     0.04154134381875743,
#     0.04154205899369311,
#     0.04154258957418161,
#     0.041542917847547815,
#     0.041543029466697884,
#     0.041542908449756645,
#     0.041542542293519086,
#     0.04154191701277997,
#     0.04154102226017253,
#     0.04153984654430927,
#     0.0415383820299297,
#     0.0415366197077289,
#     0.0415345544078049,
#     0.04153217961322652,
#     0.041529492851796884,
#     0.04152649016940564,
#     0.04152317150794045,
#     0.04151953528323943,
#     0.041515583805424944,
#     0.0415113177178261,
#     0.04150674160804181,
#     0.04150185847143783,
#     0.04149667526753401,
#     0.0414911974934697,
#     0.04148543491332202,
#     0.041479396008134495,
#     0.04147309373833303,
#     0.04146654017011672,
#     0.041459752476645156,
#     0.041452747176592586,
#     0.041445546494109975,
#     0.04143817262878109,
#     0.04143065372211434,
#     0.041423018724804306,
#     0.041415303369970236,
#     0.041407544531940274,
#     0.04139978649936825,
#     0.0413920752594512,
#     0.041384464666611186,
#     0.04137701137242837,
#     0.041369780179927526,
#     0.041362838453595396,
#     0.04135626364906171,
#     0.041350135798307444,
#     0.04134454483853882,
#     0.04133958473505503,
#     0.04133535932410074,
#     0.041331977108572664,
#     0.0413295567526787,
#     0.04132822192713345,
#     0.041328106805495514,
#     0.041329351019210425,
#     0.041332105487303455,
#     0.041336525988128564,
#     0.04134277991860946,
#     0.041351039988330784,
#     0.04136148989332708,
#     0.0413743192576232,
#     0.041389728622006815,
#     0.04140792312489375,
#     0.0414291186661247,
#     0.04145353555238783,
#     0.041481403593889764,
#     0.04151295614378847,
#     0.041548434644106215,
#     0.041588081848580774,
#     0.041632147331953126,
#     0.041680879859076564,
#     0.04173453204216074,
#     0.041793352792611205,
#     0.04185759087386835,
#     0.041927487413236916,
#     0.04200327953693689,
#     0.04208519086946518,
#     0.04217343587205207,
#     0.042268208634771806,
#     0.042369687322071206,
#     0.04247802293325432,
#     0.042593340946636776,
#     0.0427157296899628,
#     0.042845242663579974,
#     0.04298188531214853,
#     0.043125615848801854,
#     0.043276332651071156,
#     0.0434338724444037,
#     0.043597996966524874,
#     0.043768391633438514,
#     0.043944650212756446,
#     0.044126273178054065,
#     0.044312652396385314,
#     0.04450306723997996,
#     0.0446966690867103,
#     0.04489247842001219,
#     0.04508936859197267,
#     0.04528606318932069,
#     0.045481119643540485,
#     0.04567292729279393,
#     0.045859692199196056,
#     0.046039436635750525,
#     0.046209986002739706,
#     0.04636897039591944,
#     0.046513813589138656,
#     0.046641739040531746,
#     0.04674976152513871,
#     0.04683469783395908,
#     0.0468931650582383,
#     0.046921595344395065,
#     0.0469162393903167,
#     0.04687318972354377,
#     0.046788392481964855,
#     0.04665767606831547,
#     0.04647677183314733,
#     0.046241353523269316,
#     0.045947064551151245,
#     0.04558956668632294,
#     0.045164577562813626,
#     0.04466792709385775,
#     0.04409560397902677,
#     0.043443819138313314,
#     0.04270905926464026,
#     0.04188815671354021,
#     0.04097834682075374,
#     0.03997734138934038,
#     0.03888338720919369,
#     0.03769533840572063,
#     0.036412712648747694,
#     0.03503575963673261,
#     0.03356550969481875,
#     0.03200383255720887,
#     0.03035347467101258,
#     0.02861810434336247,
#     0.02680233281863672,
#     0.024911740598831687,
#     0.022952878487128098,
#     0.02093327137247498,
#     0.018861394873355516,
#     0.016746654087178243,
#     0.01459933255865417,
#     0.0124305426466279,
#     0.010252146088159437,
#     0.00807667556105041,
#     0.00591722620216774,
#     0.003787348108601641,
#     0.001700912972993152,
#     -0.00032801709040770205,
#     -0.002285347075724531,
#     -0.004157096896669134,
#     -0.00592957035044113,
#     -0.007589514799917738,
#     -0.009124292075377741,
#     -0.010522037761848718,
#     -0.011771826190969281,
#     -0.012863814526578119,
#     -0.01378939796737835,
#     -0.014541332150479865,
#     -0.015113860812139179,
#     -0.01550281854112013,
#     -0.01570573111731985,
#     -0.015721886700791037,
#     -0.015552410154392345,
#     -0.015200306518508098,
#     -0.014670502592106185,
#     -0.01396985562144483,
#     -0.01310716413880552,
#     -0.012093146090870335,
#     -0.010940400334641456,
#     -0.009663338509599342,
#     -0.00827810344285088,
#     -0.006802441209667356,
#     -0.005255555752345778,
#     -0.0036579185474235297,
#     -0.0020310533455880284,
#     -0.00039728016670717917,
#     0.0012205703023029525,
#     0.0027994715962162946,
#     0.004316545312948797,
#     0.0057494300373510995,
#     0.007076650341981515,
#     0.008278009332169975,
#     0.00933496283042429,
#     0.01023099332424271,
#     0.010951951010032556,
#     0.011486370747703725,
#     0.011825733852703836,
#     0.011964692970464192,
#     0.011901225866142274,
#     0.011636735919222804,
#     0.011176078196140565,
#     0.010527528842973404,
#     0.009702678983697272,
#     0.008716276511184718,
#     0.007585998145404304,
#     0.006332175145047055,
#     0.00497746127145165,
#     0.0035464634375413744,
#     0.0020653230867876786,
#     0.0005612713948835273,
#     -0.0009378525246488932,
#     -0.0024041037540389644,
#     -0.0038099549536807047,
#     -0.005128828903210439,
#     -0.006335640258552204,
#     -0.0074073259673887865,
#     -0.008323364832189834,
#     -0.009066262990196146,
#     -0.009621996281392192,
#     -0.009980389127850813,
#     -0.01013541518932035,
#     -0.010085402257462753,
#     -0.009833123979007635,
#     -0.009385780774062647,
#     -0.00875485246903477,
#     -0.00795582367207506,
#     -0.0070078040995303036,
#     -0.005933031555864499,
#     -0.004756302414063596,
#     -0.0035043233381620437,
#     -0.002205030657323595,
#     -0.00088687791654277,
#     0.00042186835743172717,
#     0.0016938008866763613,
#     0.002903005316252325,
#     0.0040256289690793964,
#     0.005040371941546558,
#     0.005928894117080315,
#     0.0066761211135663336,
#     0.007270463435791413,
#     0.007703929477611274,
#     0.007972155639991074,
#     0.008074339835494857,
#     0.008013106105575497,
#     0.0077942944044678796,
#     0.007426692465215328,
#     0.006921714778588703,
#     0.006293059332195332,
#     0.005556327783672812,
#     0.004728641872377761,
#     0.0038282489346353737,
#     0.002874142185067449,
#     0.001885688466195785,
#     0.0008822823029944263,
#     -0.00011698298375738617,
#     -0.0010936088252496388,
#     -0.002029968611203945,
#     -0.0029095501944641743,
#     -0.0037171813537742286,
#     -0.004439222914883814,
#     -0.005063750161159869,
#     -0.005580702349818178,
#     -0.005982022298616711,
#     -0.006261761340837696,
#     -0.006416173372877913,
#     -0.00644377019205215,
#     -0.006345359782031532,
#     -0.006124039904851792,
#     -0.0057851689909845,
#     -0.0053362851734632885,
#     -0.004786999044866718,
#     -0.0041488298772762895,
#     -0.0034350163083314705,
#     -0.002660271999808086,
#     -0.0018405185632543626,
#     -0.000992572983949197,
#     -0.00013382553293517056,
#     0.00071812000475374,
#     0.0015458015868283648,
#     0.002332271743426503,
#     0.003061455231626653,
#     0.003718507084112598,
#     0.004290138554667509,
#     0.004764929776641709,
#     0.005133594515389727,
#     0.005389216216126513,
#     0.005527415474759871,
#     0.005546477612233407,
#     0.005447397959444525,
#     0.005233870295572396,
#     0.0049121869548183605,
#     0.004491081754629296,
#     0.0039814829312229665,
#     0.003396219079852783,
#     0.00274965409768441,
#     0.002057296129892852,
#     0.0013353662998335306,
#     0.0006003697148589393,
#     -0.0001313415662860789,
#     -0.00084396893565232,
#     -0.0015226470470056548,
#     -0.002153759806075378,
#     -0.002725219596825281,
#     -0.0032266704350392174,
#     -0.003649644883279981,
#     -0.003987644433973515,
#     -0.004236183021399664,
#     -0.004392763021544607,
#     -0.00445682743145643,
#     -0.004429658768174992,
#     -0.004314272417153684,
#     -0.004115270606668865,
#     -0.003838700419368103,
#     -0.003491885878383956,
#     -0.0030832669857030932,
#     -0.0026222179467610893,
#     -0.0021188743183061867,
#     -0.0015839382574650215,
#     -0.0010284944887216547,
#     -0.00046380252713090764,
#     9.889741696394484e-05,
#     0.0006485975543814079,
#     0.0011747176035466697,
#     0.0016673132693756556,
#     0.0021172551761423925,
#     0.002516412681663414,
#     0.002857799224050772,
#     0.0031357111344303933,
#     0.0033458220258160663,
#     0.003485262036345112,
#     0.003552647382499505,
#     0.0035480932687835098,
#     0.0034731738884222034,
#     0.003330869279559622,
#     0.0031254617936191196,
#     0.0028624254672818313,
#     0.0025482720414528592,
#     0.0021903972948294596,
#     0.0017968927661265299,
#     0.0013763683250316069,
#     0.0009377483787259833,
#     0.0004900881165994381,
#     4.237328480866456e-05,
#     -0.00039665178876821874,
#     -0.0008186657021882551,
#     -0.001215913721865216,
#     -0.001581355241959511,
#     -0.0019087675808765817,
#     -0.002192848431267439,
#     -0.0024292721201923002,
#     -0.0026147432952925466,
#     -0.0027470045423501482,
#     -0.0028248445937962587,
#     -0.002848063559522933,
#     -0.00281744488136532,
#     -0.002734689412485586,
#     -0.002602362179999696,
#     -0.002423808034761759,
#     -0.0022030842769394827,
#     -0.0019448660064981457,
#     -0.001654372213133616,
#     -0.0013372668126638183,
#     -0.0009995816749227698,
#     -0.0006476151127493245,
#     -0.0002878514723242097,
#     7.314322380338849e-05,
#     0.00042880606108265315,
#     0.0007726862224120244,
#     0.0010985357190546902,
#     0.001400423137222757,
#     0.0016728278076116095,
#     0.0019107539304280257,
#     0.002109821587604371,
#     0.0022663717969412713,
#     0.0023775420201878773,
#     0.0024413484002284245,
#     0.002456732706640919,
#     0.0024236091811709586,
#     0.0023428703917079668,
#     0.002216388924790997,
#     0.002046977930202018,
#     0.0018383443230651844,
#     0.001595003490762633,
#     0.001322190027756437,
#     0.0010257334914088537,
#     0.0007119353180469155,
#     0.00038741810102118496,
#     5.898263121810465e-05,
#     -0.0002665553053523371,
#     -0.0005825110967928801,
#     -0.0008824903693836171,
#     -0.0011605218993070397,
#     -0.0014111957487186258,
#     -0.0016297675930592274,
#     -0.001812261445200393,
#     -0.001955532995702801,
#     -0.002057327961143999,
#     -0.00211629815803328,
#     -0.0021320125510970803,
#     -0.0021049278669477006,
#     -0.002036357695731846,
#     -0.0019284059685734135,
#     -0.00178390612953689,
#     -0.0016063305805846528,
#     -0.0013997136906920352,
#     -0.001168551246630671,
#     -0.000917719001594243,
#     -0.0006523716312455581,
#     -0.00037786294568459625,
#     -9.964688890600273e-05,
#     0.00017680010002036478,
#     0.0004460786423107505,
#     0.0007029458011346846,
#     0.0009424171421405659,
#     0.0011598493654956157,
#     0.0013510446445790802,
#     0.0015123308472485015,
#     0.0016406596019219507,
#     0.0017336729734632322,
#     0.0017897797268667526,
#     0.001808194425446939,
#     0.001788976942892876,
#     0.0017330284111368045,
#     0.0016420843020793462,
#     0.0015186602136412035,
#     0.0013659963574967453,
#     0.0011879568234532765,
#     0.0009889317180891352,
#     0.0007737012192071263,
#     0.0005473124214886872,
#     0.0003149262092290526,
#     8.168793754987844e-05,
#     -0.00014741871681339148,
#     -0.0003676862822424524,
#     -0.0005748044590788946,
#     -0.0007649392056018958,
#     -0.000934813331175028,
#     -0.0010817407382877828,
#     -0.0012036602390063274,
#     -0.0012991243934454416,
#     -0.0013672919650340488,
#     -0.0014078812591487473,
#     -0.0014211358479191381,
#     -0.0014077605361375624,
#     -0.0013688773676887034,
#     -0.0013059610254148868,
#     -0.001220800909288694,
#     -0.001115446088085479,
#     -0.0009921790956533422,
#     -0.0008534711141709277,
#     -0.0007019629992972114,
#     -0.0005404245886672775,
#     -0.0003717348511009331,
#     -0.00019883666660787565,
#     -2.4709473277644e-05,
#     0.0001476836053241979,
#     0.0003154301304321063,
#     0.00047572553704658405,
#     0.0006259087665200641,
#     0.0007635153352728938,
#     0.0008863053595606924,
#     0.0009923065426119884,
#     0.0010798293766463817,
#     0.0011474957194116502,
#     0.001194241138374609,
#     0.0012193325753850088,
#     0.0012223617935586996,
#     0.0012032562705388758,
#     0.00116226961762219,
#     0.0010999907954123578,
#     0.001017334405538339,
#     0.0009155493278236917,
#     0.0007962080497626051,
#     0.0006612115633215093,
#     0.0005127728195746598,
#     0.0003534128222024407,
#     0.00018593039065937546,
#     1.3382224010980923e-05,
#     -0.00016096564405806806,
#     -0.0003336801877325702,
#     -0.0005012310379687648,
#     -0.0006600538761740056,
#     -0.0008066404055355643,
#     -0.0009376174703815132,
#     -0.0010498481566421775,
#     -0.001140516875380266,
#     -0.001207229425834469,
#     -0.0012480881940750352,
#     -0.0012617758346299864,
#     -0.0012476073436116716,
#     -0.00120558223093847,
#     -0.0011363999221710754,
#     -0.0010414699659129223,
#     -0.0009228828769953824,
#     -0.0007833743012128531,
#     -0.0006262506296114689,
#     -0.00045530993118568334,
#     -0.00027472860413055647,
#     -8.895039699396805e-05,
#     9.745141147881296e-05,
#     0.00027990113761522037,
#     0.0004539637391170262,
#     0.0006154668419228425,
#     0.0007606289328278663,
#     0.0008861562412798459,
#     0.0009893373850420589,
#     0.0010681003550425498,
#     0.001121062938756974,
#     0.0011475423533241942,
#     0.0011475590354299119,
#     0.00112180138180051,
#     0.0010715896107089274,
#     0.0009988047763035569,
#     0.0009058241486842849,
#     0.0007954278846158524,
#     0.0006707179991791348,
#     0.000535014789950692,
#     0.00039177132870786904,
#     0.0002444694728808046,
#     9.653901417677746e-05,
#     -4.8737760291761925e-05,
#     -0.00018829287026823904,
#     -0.0003193508320467487,
#     -0.0004394736834122219,
#     -0.0005466138856396394,
#     -0.0006391308442051692,
#     -0.0007158139832869233,
#     -0.0007758689633765338,
#     -0.0008189122955605151,
#     -0.0008449321751125075,
#     -0.000854262182159584,
#     -0.000847526240822502,
#     -0.0008256035266259801,
#     -0.0007895699991341681,
#     -0.0007406654183743887,
#     -0.0006802419601399622,
#     -0.0006097400723550465,
#     -0.0005306498877758713,
#     -0.00044449846250366014,
#     -0.00035282282825482326,
#     -0.00025716704206654034,
#     -0.0001590619810781669,
#     -6.002820609746738e-05,
#     3.8442359170474255e-05,
#     0.00013488382561700936,
#     0.00022787572768962795,
#     0.00031604450361910966,
#     0.0003980859688685716,
#     0.0004727697676233638,
#     0.0005389651133524114,
#     0.0005956472914495099,
#     0.0006419235059114958,
#     0.0006770383859318798,
#     0.0007003975713789357,
#     0.0007115693990419961,
#     0.0007103040109575059,
#     0.000696529882918729,
#     0.000670367610866876,
#     0.0006321213599692465,
#     0.0005822885850314853,
#     0.0005215478471194308,
#     0.0004507661500438957,
#     0.00037098520773466877,
#     0.00028342758097366604,
#     0.0001894815979627696,
#     9.070597548965081e-05,
#     -1.1188328066624731e-05,
#     -0.00011433914368158202,
#     -0.00021675888946977306,
#     -0.00031634702977260606,
#     -0.00041093030766757924,
#     -0.0004982924657696668,
#     -0.0005762338712738176,
#     -0.000642622961055165,
#     -0.0006954758275670922,
#     -0.0007330257054394829,
#     -0.0007538157651575429,
#     -0.0007567754435960986,
#     -0.0007413085497165427,
#     -0.0007073558407168293,
#     -0.0006554547542046534,
#     -0.0005867613290707931,
#     -0.0005030557627944549,
#     -0.00040669963828059326,
#     -0.00030057139480796705,
#     -0.0001879534384715397,
#     -7.240119505530843e-05,
#     4.2423240817336325e-05,
#     0.00015291835896218825,
#     0.0002557211108035421,
#     0.0003478618548167275,
#     0.00042690396979366656,
#     0.0004910381405424415,
#     0.000539145683104314,
#     0.0005708056554042489,
#     0.0005862707265225885,
#     0.0005863938346575715,
#     0.0005725357250864968,
#     0.0005464390237561925,
#     0.0005101062929311565,
#     0.00046566322271545876,
#     0.0004152425706918199,
#     0.000360873986595971,
#     0.0003044016926870251,
#     0.0002474162279239578,
#     0.00019121948985656792,
#     0.00013680090608009406,
#     8.484797470954125e-05,
#     3.575884387656443e-05,
#     -1.0314813042713866e-05,
#     -5.3431145713498177e-05,
#     -9.379747126127269e-05,
#     -0.00013172494531229345,
#     -0.00016755903355275374,
#     -0.00020163788062445287,
#     -0.00023422801167315155,
#     -0.0002654918593013294,
#     -0.0002954366670886617,
#     -0.0003238982146812081,
#     -0.0003505097675305293,
#     -0.00037470683741430873,
#     -0.0003957227064763421,
#     -0.0004126194420258217,
#     -0.00042431239551521567,
#     -0.00042963201405583386,
#     -0.00042737740788192577,
#     -0.0004164070539741764,
#     -0.0003957129040027957,
#     -0.00036452730956891034,
#     -0.00032240618021303104,
#     -0.00026932742135876014,
#     -0.0002057510127311899,
#     -0.00013268103000524736,
#     -5.1669873808129e-05,
#     3.51873230944634e-05,
#     0.0001253278247093266,
#     0.00021580853003797494,
#     0.00030345895060631886,
#     0.00038503253917676616,
#     0.0004574020867923207,
#     0.0005177235934184232,
#     0.0005636175795199778,
#     0.0005932878688012302,
#     0.0006056307464248605,
#     0.0006002657721348795,
#     0.000577552477300125,
#     0.0005385278396430517,
#     0.0004848411893284624,
#     0.00041862634344820744,
#     0.00034239624983080884,
#     0.00025888932799622046,
#     0.00017096150352153942,
#     8.144797989422144e-05,
#     -6.921070943284244e-06,
#     -9.162678300150655e-05,
#     -0.00017040753663408875,
#     -0.00024132726593131815,
#     -0.00030278671631873456,
#     -0.0003535592264341282,
#     -0.0003927731007489551,
#     -0.0004199234690813163,
#     -0.000434834358358881,
#     -0.0004376568417516439,
#     -0.00042881905605444276,
#     -0.0004090140443027048,
#     -0.00037914574072861126,
#     -0.0003403097121059597,
#     -0.00029373553006434815,
#     -0.0002407670883998944,
#     -0.00018280233345991,
#     -0.00012127327367555257,
#     -5.7587638568850144e-05,
#     6.88881059815287e-06,
#     7.088487844346576e-05,
#     0.00013323628870272504,
#     0.00019292768397997234,
#     0.00024909499706492026,
#     0.0003010535365946289,
#     0.00034828701813777174,
#     0.0003904597778653478,
#     0.0004273909832985933,
#     0.0004590521765480051,
#     0.0004855294095984699,
#     0.0005070101543512579,
#     0.0005237389542048342,
#     0.0005360006871511589,
#     0.0005440771617210276,
#     0.0005482367324473481,
#     0.0005487014312877559,
#     0.0005456505010787548,
#     0.0005392048094059396,
#     0.0005294490870651741,
#     0.0005164354595768583,
#     0.0005002230221372948,
#     0.0004808957520606484,
#     0.0004586088070287521,
#     0.00043360617039117123,
#     0.0004062602427602688,
#     0.00037707401696026634,
#     0.0003467000497974146,
#     0.0003159142718404586,
#     0.00028560854466046226,
#     0.0002567361269647378,
#     0.00023028212622478068,
#     0.0002071935862957095,
#     0.00018834368475705542,
#     0.0001744642136463602,
#     0.00016612132252650895,
#     0.00016366752167306167,
#     0.0001672431868206814,
#     0.00017675671287985598,
#     0.00019191619625011022,
#     0.00021223378452231607,
#     0.00023707873522466234,
#     0.0002657004812530901,
#     0.00029729240987609075,
#     0.000331015555054881,
#     0.000366060298937914,
#     0.0004016602100674199,
#     0.0004371408343987991,
#     0.00047192088206042364,
#     0.0005055369468497852,
#     0.000537628158923659,
#     0.0005679470688054276,
#     0.000596323262090229,
#     0.0006226629324352865,
#     0.0006469048900244034,
#     0.0006690138617776557,
#     0.00068893827649401,
#     0.0007066036277703722,
#     0.0007218801575282433,
#     0.000734587420136901,
#     0.0007444754176644721,
#     0.0007512450387629644,
#     0.0007545457878328533,
#     0.0007540146116370872,
#     0.0007492834644091395,
#     0.0007400311091256655,
#     0.0007259979837400884,
#     0.0007070409806391592,
#     0.0006831447416430526,
#     0.0006544648448848101,
#     0.0006213265934185124,
#     0.0005842512933952031,
#     0.0005439308903733616,
#     0.0005012322882720251,
#     0.00045715165386274285,
#     0.0004127966950905216,
#     0.0003693232509379193,
#     0.00032791156604644427,
#     0.000289695415147468,
#     0.0002557356689724486,
#     0.00022695803365848505,
#     0.00020414085809785341,
#     0.0001878663318206509,
#     0.00017852619445586637,
#     0.00017629439852402846,
#     0.00018115081251452586,
#     0.00019287093191966767,
#     0.0002110676913991208,
#     0.00023519150633667316,
#     0.0002645845324440229,
#     0.0002984830805842862,
#     0.0003360765702433797,
#     0.00037650697050051196,
#     0.0004189247337552191,
#     0.0004624829433089381,
#     0.0005063820635514468,
#     0.0005498567000130072,
#     0.0005922080788394717,
#     0.0006327813550810364,
#     0.0006709855106808837,
#     0.0007062657607450583,
#     0.0007381165867192015,
#     0.0007660511977505471,
#     0.0007896182842484414,
#     0.0008083713902211909,
#     0.0008218973295127212,
#     0.0008297989636491133,
#     0.000831735770349503,
#     0.0008274178224032119,
#     0.0008166553074863449,
#     0.0007993637407575586,
#     0.0007756119500734789,
#     0.0007456225051844529,
#     0.0007098090650220681,
#     0.0006687574295398506,
#     0.0006232456990420653,
#     0.000574202211369463,
#     0.0005227038879560449,
#     0.00046991618389951965,
#     0.00041707887748770357,
#     0.00036543655191651446,
#     0.0003162224716601724,
#     0.0002705948693793349,
#     0.00022962821753316938,
#     0.0001942591853702283,
#     0.0001652934048767627,
#     0.00014336420398751958,
#     0.0001289538146471321,
#     0.00012236283679224053,
#     0.00012374102161123723,
#     0.0001330611917530894,
#     0.0001501566375336806,
#     0.00017469605571753845,
#     0.00020622135243902016,
#     0.00024412097768466284,
#     0.0002876696642482215,
#     0.0003360008103656491,
#     0.0003881487059504904,
#     0.0004430250648802137,
#     0.0004994679304218576,
#     0.0005562253770253784,
#     0.0006120153811895734,
#     0.0006655181897214507,
#     0.0007154483540645282,
#     0.0007605535710411473,
#     0.0007996926486134575,
#     0.0008318369777462892,
#     0.0008561461945517032,
#     0.0008719634136797952,
#     0.0008788801067122938,
#     0.0008767153958531143,
#     0.0008655661529236441,
#     0.0008457662508623773,
#     0.0008179166661710664,
#     0.0007828259298890798,
#     0.0007415234250310529,
#     0.0006951831426633727,
#     0.0006451276200191772,
#     0.0005927393777141569,
#     0.000539459667454098,
#     0.0004867005134305616,
#     0.00043584402341924865,
#     0.00038815683695044186,
#     0.0003447988951238608,
#     0.0003067467387140501,
#     0.00027481343435562314,
#     0.00024958475068948514,
#     0.00023145371777769444,
#     0.0002205704022094461,
#     0.0002168926302076532,
#     0.00022014820967148317,
#     0.00022989968153537543,
#     0.0002455180928485068,
#     0.00026625887257018983,
#     0.00029124141633313574,
#     0.0003195328358024871,
#     0.00035012855886221335,
#     0.0003820392069015261,
#     0.0004142676388473477,
#     0.00044589374226181207,
#     0.00047604562697749556,
#     0.000503978171817087,
#     0.0005290363989308919,
#     0.0005507263768408498,
#     0.0005686682835609538,
#     0.000582661756904284,
#     0.0005926285539116088,
#     0.0005986695040208073,
#     0.0006009993025553571,
#     0.0005999974768793569,
#     0.0005961330339695446,
#     0.0005900094356651366,
#     0.0005822809232089842,
#     0.0005736898247130136,
#     0.0005649782594909728,
#     0.0005569161706253257,
#     0.0005502062891755387,
#     0.0005455087182174682,
#     0.0005433422911778844,
#     0.0005441067695552294,
#     0.0005479864671716506,
#     0.0005549796058908207,
#     0.0005648138941769833,
#     0.0005769934730750839,
#     0.0005907421969780103,
#     0.000605082302888681,
#     0.0006188177008728188,
#     0.0006306555407115857,
#     0.0006392331563186276,
#     0.000643275927718465,
#     0.0006416493861672781,
#     0.0006335257114386678,
#     0.0006184214498726141,
#     0.0005963205880875257,
#     0.0005676508188143768,
#     0.0005333259192447683,
#     0.000494638038634183,
#     0.0004532190324022557,
#     0.0004108670893404904,
#     0.0003694726697051464,
#     0.0003308327454935433,
#     0.00029659480479370115,
#     0.0002681106033710981,
#     0.00024643301262715876,
#     0.0002322275205154066,
#     0.00022583135171996144,
#     0.00022721316920724065,
#     0.00023607141219325611,
#     0.0002518225109166671,
#     0.00027371616919254216,
#     0.0003008294006837161,
#     0.00033218233961051537,
#     0.0003667223104913495,
#     0.00040343051416296544,
#     0.0004412914841143544,
#     0.00047938456913901306,
#     0.0005168392154644205,
#     0.0005529130894641812,
#     0.0005869337684503567,
#     0.0006183652371715941,
#     0.0006467399503253413,
#     0.0006717177555011639,
#     0.0006930114392688733,
#     0.0007104424660374902,
#     0.0007238631868621889,
#     0.0007332114697165097,
#     0.0007384346701187049,
#     0.0007395473945501305,
#     0.0007365591296646309,
#     0.0007295337630260305,
#     0.0007185262645782713,
#     0.00070364828440205,
#     0.0006850091007047365,
#     0.0006627858297904455,
#     0.0006371714484721888,
#     0.000608448600974509,
#     0.0005769387635404383,
#     0.0005430735687714551,
#     0.0005073435142661092,
#     0.0004703635147855177,
#     0.0004328136966371531,
#     0.0003954930221813143,
#     0.00035924787215834385,
#     0.0003250127991901216,
#     0.000293723187365421,
#     0.00026634401306700056,
#     0.00024377165157962385,
#     0.00022685234847158106,
#     0.00021628177426847445,
#     0.0002126272309302922,
#     0.00021623147577950683,
#     0.0002272457105677514,
#     0.0002455524161372579,
#     0.0002708173326294149,
#     0.00030243482391805604,
#     0.0003396029452970954,
#     0.00038128913674836257,
#     0.0004263264440204674,
#     0.00047339540625353227,
#     0.0005211340171562967,
#     0.0005681244463421678,
#     0.0006130070688776332,
#     0.0006544663343464544,
#     0.0006913375877672812,
#     0.0007225829196724157,
#     0.0007473861045506555,
#     0.0007651128273481432,
#     0.0007753891176473914,
#     0.000778042718711092,
#     0.0007731668569718325,
#     0.0007610438110328219,
#     0.0007421934449173932,
#     0.0007172825385016197,
#     0.0006871653003956008,
#     0.0006527835511718188,
#     0.000615200104211483,
#     0.0005754971210971856,
#     0.0005348117854458313,
#     0.0004942321483677094,
#     0.0004548387897956325,
#     0.00041760610081271847,
#     0.00038345049945806044,
#     0.00035313853438914515,
#     0.00032734323934813583,
#     0.00030656080783249273,
#     0.0002911754771814587,
#     0.0002813814667381384,
#     0.00027726004889590435,
#     0.0002787069771683186,
#     0.00028551603363913963,
#     0.00029731293934779496,
#     0.00031364707444992215,
#     0.0003339309720037393,
#     0.00035753474157281147,
#     0.0003837278282388251,
#     0.0004117797833661733,
#     0.00044090350685690137,
#     0.00047035428613115965,
#     0.0004993721411598161,
#     0.000527279481893194,
#     0.0005534211425149357,
#     0.0005772554408165851,
#     0.000598288104747555,
#     0.0006161605531929768,
#     0.0006305734709102055,
#     0.0006413692821316715,
#     0.0006484510895948311,
#     0.0006518573394634092,
#     0.0006516744517890902,
#     0.0006481067412733021,
#     0.000641387347262554,
#     0.0006318440634857907,
#     0.0006198090408473245,
#     0.0006056833165744204,
#     0.0005898495573703755,
#     0.0005727372233571802,
#     0.0005547364912232289,
#     0.0005362669178376345,
#     0.0005176956356104483,
#     0.0004994066483480254,
#     0.0004817219744234543,
#     0.00046497488331685884,
#     0.00044943149922689433,
#     0.00043536492399449955,
#     0.00042297795239774026,
#     0.00041247693780151716,
#     0.00040399614802091345,
#     0.0003976689211966679,
#     0.00039355354594539094,
#     0.00039170445331768167,
#     0.0003920980350407121,
#     0.0003947039480240288,
#     0.0003994143521274512,
#     0.0004061155882289086,
#     0.00041461928999532785,
#     0.00042473533654109434,
#     0.00043620657117306345,
#     0.00044878353867414296,
#     0.00046215958534693777,
#     0.00047604776058707624,
#     0.0004901183121730143,
#     0.0005040747433031362,
#     0.0005175892394042002,
#     0.0005303822453246905,
#     0.0005421559247178187,
#     0.0005526730535783675,
#     0.0005616897755901466,
#     0.0005690337606810841,
#     0.0005745333360796939,
#     0.00057809902929375,
#     0.0005796467722004213,
#     0.0005791813839243504,
#     0.0005767161253467223,
#     0.0005723536583465364,
#     0.0005662028539409596,
#     0.0005584606465429427,
#     0.0005493221740158309,
#     0.0005390623303518742,
#     0.0005279413195086995,
#     0.0005162863562561595,
#     0.0005043924188940473,
#     0.0004926050051217382,
#     0.0004812188217863285,
#     0.0004705598235167762,
#     0.0004608832688027843,
#     0.0004524613967881678,
#     0.0004454779325569081,
#     0.0004401187216523401,
#     0.00043646967267253756,
#     0.00043461054814591255,
#     0.00043451432119132223,
#     0.00043614546433201964,
#     0.0004393631046264359,
#     0.0004440215592068121,
#     0.0004498789709545363,
#     0.0004567041768387056,
#     0.0004641848031813889,
#     0.00047204118824315834,
#     0.0004799411747736151,
#     0.0004876132356699224,
#     0.0004947651806823557,
#     0.0005011974841209067,
#     0.0005067208747466297,
#     0.0005112650704622787,
#     0.0005147888216014591,
#     0.0005173782540367888,
#     0.0005191457438944343,
#     0.0005203106876975443,
#     0.000521085968691647,
#     0.0005217467023553597,
#     0.000522506991618486,
#     0.0005235850682357331,
#     0.0005250870714755568,
#     0.0005270803493425281,
#     0.0005294932412238888,
#     0.0005322100597522968,
#     0.0005349924276847207,
#     0.0005375913402896112,
#     0.0005396858447424928,
#     0.0005410020148065402,
#     0.0005412483399861757,
#     0.000540232672656701,
#     0.000537786603914691,
#     0.0005338668331316947,
#     0.0005284675608933226,
#     0.000521710142137026,
#     0.000513744025509702,
#     0.0005048290684466876,
#     0.0004952270300749226,
#     0.00048528102853424675,
#     0.00047530628774984825,
#     0.0004656662921680866,
#     0.0004566661440827957,
#     0.000448633574923309,
#     0.0004418100928996662,
#     0.0004364409251750006,
#     0.00043266918317187535,
#     0.00043062896454303286,
#     0.0004303471140213993,
#     0.00043184021687728974,
#     0.00043501897260670927,
#     0.0004397925256139322,
#     0.0004459756370651137,
#     0.00045339435083881045,
#     0.00046179744342947013,
#     0.00047096387104154924,
#     0.0004806128050614932,
#     0.0004905124180370358,
#     0.000500387956338286,
#     0.0005100282248035343,
#     0.0005191900054530418,
#     0.0005277021942955689,
#     0.0005353660903928761,
#     0.0005420567889387416,
#     0.0005476209649534925,
#     0.0005519779194758361,
#     0.0005550168043389602,
#     0.0005566976498222864,
#     0.0005569508456732958,
#     0.0005557813196262577,
#     0.0005531679894949862,
#     0.0005491703849918525,
#     0.0005438281078853063,
#     0.0005372677063973739,
#     0.0005295976392355184,
#     0.0005210170714645187,
#     0.0005117044276665983,
#     0.0005019248790399302,
#     0.0004919116942075814,
#     0.0004819774464555615,
#     0.0004723873858948572,
#     0.0004634701383287917,
#     0.0004554889272890793,
#     0.0004487522364136423,
#     0.00044348206521063055,
#     0.0004399269861072117,
#     0.00043822466311387726,
#     0.00043851947515057346,
#     0.00044082266044157686,
#     0.0004451325387213635,
#     0.0004512955174768678,
#     0.000459130011037168,
#     0.00046829700695789726,
#     0.00047843000544511675,
#     0.0004890200398146929,
#     0.0004995620823919251,
#     0.0005094600826870931,
#     0.0005181909357701645,
#     0.0005252327669424458,
#     0.0005302343984869978,
#     0.0005329466885199193,
#     0.0005333741783032902,
#     0.0005316724511952742,
#     0.0005282463479139559,
#     0.0005235952712760138,
#     0.0005183552527309367,
#     0.0005131113218197741,
#     0.0005084295469865996,
#     0.000504688388215848,
#     0.0005021548276871925,
#     0.0005008665667298393,
#     0.000500760396038611,
#     0.0005015923421716178,
#     0.0005030968565513938,
#     0.0005049089231998101,
#     0.0005067241899085161,
#     0.0005082068503872977,
#     0.0005091361916599348,
#     0.0005092912085055534,
#     0.0005085885608667202,
#     0.0005069481677757517,
#     0.0005044265256650797,
#     0.0005010694020728072,
#     0.0004970449960011326,
#     0.0004924907307758443,
#     0.0004876468312506946,
#     0.00048269950147718926,
#     0.0004779179681546602,
#     0.0004734939758707056,
#     0.000469684223913705,
#     0.00046664914034693847,
#     0.000464596681272399,
#     0.00046362320649290766,
#     0.00046386046838919025,
#     0.00046531568934772213,
#     0.00046802537790813226,
#     0.000471895772835516,
#     0.0004768603871340635,
#     0.0004827244432315317,
#     0.0004893259254124538,
#     0.0004963836060848398,
#     0.0005036619309298721,
#     0.0005108228508248543,
#     0.0005175957038908285,
#     0.0005236309215984579,
#     0.0005286744099323726,
#     0.000532425034369878,
#     0.0005347082128160634,
#     0.0005353374874984239,
#     0.0005342827311524221,
#     0.0005315332770144,
#     0.0005272560632883314,
#     0.0005216481720039939,
#     0.0005150782647101119,
#     0.0005079229680275462,
#     0.0005006823275937669,
#     0.0004937979295022779,
#     0.0004877465921874994,
#     0.00048285566872952913,
#     0.0004793970609741436,
#     0.0004774241847268039,
#     0.00047690189007714573,
#     0.00047758402053267764,
#     0.0004791854635693756,
#     0.0004812930719737766,
#     0.0004835554742208953,
#     0.00048559338239188843,
#     0.00048717539719580864,
#     0.00048809650060052147,
#     0.0004883301278001129,
#     0.00048787380140465596,
#     0.0004868823264651493,
#     0.00048549428061421887,
#     0.00048396354534759566,
#     0.0004824795295013534,
#     0.0004813050696144804,
#     0.00048060029892649757,
#     0.0004805729194727118,
#     0.0004813022696966516,
#     0.0004829011797512755,
#     0.0004853454211202878,
#     0.0004886444083907066,
#     0.0004926719899992823,
#     0.0004973449813788361,
#     0.0005024544413011478,
#     0.0005078515547636588,
#     0.0005132778282245631,
#     0.0005185535342450021,
#     0.0005234083324051775,
#     0.0005276718402799276,
#     0.0005311012943050412,
#     0.0005335722629487057,
#     0.0005349035739297993,
#     0.0005350454238044061,
#     0.0005339010977145151,
#     0.00053151311741754,
#     0.0005278810683882612,
#     0.0005231437644538043,
#     0.0005173940609103679,
#     0.0005108591231885416,
#     0.0005037111151274566,
#     0.000496243381907558,
#     0.0004886791751942208,
#     0.0004813441072110333,
#     0.000474471780792806,
#     0.0004683741917241857,
#     0.0004632458865496073,
#     0.00045933334950813524,
#     0.0004567402635257383,
#     0.0004555982680352188,
#     0.00045588039309445855,
#     0.00045757739771408804,
#     0.0004605200519314772,
#     0.00046456711358114876,
#     0.00046943836536469594,
#     0.00047491256344730365,
#     0.00048066621066976054,
#     0.00048647647029268284,
#     0.000492057869458962,
#     0.0004972599558203134,
#     0.0005018922570308136,
#     0.0005059139144211258,
#     0.000509243212549736,
#     0.0005119396571533,
#     0.0005140007598410934,
#     0.0005155455745045716,
#     0.000516603913450802,
#     0.0005173064908860006,
#     0.0005176730641215949,
#     0.0005178124561711229,
#     0.0005177109301069474,
#     0.0005174439787269652,
#     0.0005169625943871603,
#     0.0005163134004985744,
#     0.0005154221569610186,
#     0.000514320704933114,
#     0.0005129274982286994,
#     0.0005112774776682583,
#     0.0005092985909521345,
#     0.000507043836642131,
#     0.0005044652428787925,
#     0.0005016444876837032,
#     0.0004985622447372245,
#     0.0004953298260553293,
#     0.0004919562844467942,
#     0.000488577845955001,
#     0.00048522264928215104,
#     0.0004820410998209925,
#     0.0004790672035275261,
#     0.0004764522172573931,
#     0.0004742248475880437,
#     0.00047252244553501986,
#     0.00047135507097236136,
#     0.00047083475618803737,
#     0.00047094266635409367,
#     0.00047175585179876425,
#     0.0004732168842425024,
#     0.0004753615418355492,
#     0.0004780890437129162,
#     0.00048138999913818585,
#     0.00048511988680925884,
#     0.0004892261951958826,
#     0.0004935274072149359,
#     0.0004979405737106108,
#     0.0005022640605627932,
#     0.0005064051430960625,
#     0.0005101654794065092,
#     0.0005134708071322745,
#     0.0005161550839453254,
#     0.0005181898688422799,
#     0.0005194645185515653,
#     0.0005200149659209449,
#     0.0005197963556421333,
#     0.0005189105223282215,
#     0.000517369389753726,
#     0.0005153259607761761,
#     0.0005128277258040527,
#     0.0005100512765806742,
#     0.0005070487330492788,
#     0.0005039932647056006,
#     0.000500917612662086,
#     0.0004979712654379544,
#     0.0004951540371301577,
#     0.0004925853792121602,
#     0.000490232467703763,
#     0.00048818772531325494,
#     0.00048639478030565106,
#     0.0004849307827972608,
#     0.00048372674129641517,
#     0.0004828549576509668,
#     0.0004822440104554765,
#     0.0004819679071949197,
#     0.00048195508520883223,
#     0.0004822796277165961,
#     0.00048286687081866564,
#     0.00048378533218658946,
#     0.0004849495065989435,
#     0.0004864133688941268,
#     0.00048807433556658994,
#     0.0004899645874591411,
#     0.0004919599037028818,
#     0.0004940730921155854,
#     0.0004961632780702621,
#     0.0004982314630836201,
#     0.0005001312713474992,
#     0.0005018679469372227,
#     0.000503306306622724,
#     0.0005044735631564018,
#     0.0005052617731924145,
#     0.0005057317592001495,
#     0.0005058091469930942,
#     0.0005055919157197376,
#     0.0005050353942903998,
#     0.000504267456389788,
#     0.0005032615156684798,
#     0.0005021593237183423,
#     0.0005009365164693434,
#     0.00049973633300383,
#     0.0004985219505575841,
#     0.000497423154600711,
#     0.0004963841909814033,
#     0.000495517230837416,
#     0.000494743055291489,
#     0.0004941567816324436,
#     0.000493659332947257,
#     0.0004933297367329618,
#     0.0004930554144710608,
#     0.0004929062449087959,
#     0.0004927607836797358,
#     0.0004926867030590823,
#     0.0004925621873800752,
#     0.0004924585533103987,
#     0.0004922608193325927,
#     0.0004920499347534236,
#     0.0004917254838221214,
#     0.000491385289671015,
#     0.000490946581181732,
#     0.0004905244973045942,
#     0.0004900538138593851,
#     0.0004896641803314086,
#     0.0004893027020395468,
#     0.0004891055078245082,
#     0.0004890220770068614,
#     0.0004891846780058617,
#     0.0004895341592101032,
#     0.000490186539432105,
#     0.0004910617406126295,
#     0.0004922490476591875,
#     0.0004936390297492974,
#     0.0004952846822950455,
#     0.0004970432660077757,
#     0.0004989327433214293,
#     0.0005007805668426034,
#     0.0005025765274709812,
#     0.0005041352356403711,
#     0.0005054409661661083,
#     0.0005063220527518151,
#     0.0005067889003457331,
#     0.0005067173986907994,
#     0.0005061744961904636,
#     0.0005051084012845358,
#     0.0005036582767810362,
#     0.0005018452293150937,
#     0.0004998651982992021,
#     0.0004977792877338058,
#     0.0004957977002138323,
#     0.0004939696827718186,
#     0.0004924697759593442,
#     0.0004912923528753305,
#     0.000490549514602593,
#     0.0004901663758398282,
#     0.0004901969524608342,
#     0.0004905130265656383,
#     0.000491135826625055,
#     0.0004919114868877292,
#     0.0004928551342379319,
#     0.0004938095182797121,
#     0.0004948000416891054,
#     0.0004956759693051475,
#     0.0004964774917098867,
#     0.0004970623931061305,
#     0.0004974844882019939,
#     0.0004976095353533948,
#     0.0004975031329389409,
#     0.0004970423302976083,
#     0.0004963118145346699,
#     0.0004952104507837257,
#     0.0004938569102444623,
#     0.0004921926711467361,
#     0.0004903876028876115,
#     0.0004884410492909299,
#     0.0004865797521363159,
#     0.0004848506830844833,
#     0.00048351055064281556,
#     0.000482607519361182,
#     0.00048236423786254985,
#     0.0004827587718415835,
#     0.0004839145689515545,
#     0.00048569009049085655,
#     0.0004880894137890279,
#     0.00049086238304712,
#     0.0004939360045696454,
#     0.0004970148905728746,
#     0.0005000238799911915,
#     0.0005026953194191067,
#     0.0005050148822406762,
#     0.0005067863931202538,
#     0.000508081453175227,
#     0.0005087818944917999,
#     0.0005090342481786081,
#     0.000508776476545604,
#     0.0005081998966180497,
#     0.0005072651268059197,
#     0.0005061757522870289,
#     0.0005048852999234785,
#     0.0005035857065339173,
#     0.0005022054981140226,
#     0.0005009112289103713,
#     0.0004996034333137177,
#     0.0004984226880905204,
#     0.0004972459893285968,
#     0.0004961976181034524,
#     0.0004951403464250603,
#     0.000494191746719894,
#     0.0004932148769115196,
#     0.0004923307212453057,
#     0.0004914127308711675,
#     0.0004905897607496469,
#     0.000489750053135932,
#     0.0004890313038453751,
#     0.0004883331632346936,
#     0.00048779464420955,
#     0.0004873193123422718,
#     0.0004870380742796627,
#     0.00048684792907515047,
#     0.0004868642864121579,
#     0.0004869733124195849,
#     0.0004872742981402549,
#     0.0004876455241874054,
#     0.00048817787645064753,
#     0.0004887493205287877,
#     0.0004894540701431416,
#     0.0004901742559941229,
#     0.000491011937100324,
#     0.0004918543451587418,
#     0.0004928117012571176,
#     0.0004937689621752912,
#     0.0004948390255899351,
#     0.0004958954265865713,
#     0.0004970490348232392,
#     0.000498157153667151,
#     0.0004993257247572491,
#     0.0005003944948981549,
#     0.0005014682088607357,
#     0.0005023721344645949,
#     0.0005032146921311337,
#     0.0005038121285887848,
#     0.0005042834504410745,
#     0.0005044444588759092,
#     0.0005044303107951537,
#     0.000504062159329341,
#     0.0005034966967344904,
#     0.0005025670088596619,
#     0.0005014545547033962,
#     0.0005000085436323506,
#     0.0004984347571811622,
#     0.0004965998083389898,
#     0.0004947332726671066,
#     0.0004927191054908461,
#     0.0004908027810578419,
#     0.0004888792926953378,
#     0.00048720068504253845,
#     0.0004856626250868742,
#     0.000484509117975632,
#     0.000483622073974288,
#     0.00048322128831435225,
#     0.00048316107132985973,
#     0.00048362412464693187,
#     0.0004844288205576846,
#     0.0004857166524756835,
#     0.0004872698851728519,
#     0.0004891924844548715,
#     0.0004912418828012088,
#     0.0004934985153613198,
#     0.0004957091939750205,
#     0.000497946550769162,
#     0.0004999624051167072,
#     0.0005018365425463901,
#     0.0005033407790444415,
#     0.0005045725889561217,
#     0.0005053317214807531,
#     0.0005057419986384832,
#     0.0005056367186507555,
#     0.0005051673040780379,
#     0.0005042029979016593,
#     0.0005029226484907154,
#     0.000501228577277359,
#     0.0004993225800158391,
#     0.0004971359410702522,
#     0.0004948842317993481,
#     0.0004925190955704581,
#     0.0004902593035124962,
#     0.00048806632563457714,
#     0.00048614891511974435,
#     0.00048446729903196817,
#     0.00048320590296060256,
#     0.00048231415231794576,
#     0.00048193882595898817,
#     0.0004820108264422529,
#     0.00048263019986657246,
#     0.00048370657274823294,
#     0.0004852872382688309,
#     0.00048726198879881465,
#     0.0004896239451576499,
#     0.0004922494491200087,
#     0.0004950786624798569,
#     0.0004979809464285782,
#     0.0005008473419835149,
#     0.0005035467555322901,
#     0.0005059299359435245,
#     0.0005078788910874779,
#     0.0005092306127522667,
#     0.0005099133142138328,
#     0.0005097977581677605,
#     0.0005089051945547495,
#     0.0005071965642244967,
#     0.0005048189921680688,
#     0.0005018455162607866,
#     0.0004985307297695786,
#     0.0004950283084384742,
#     0.0004916333976786522,
#     0.0004885166504261188,
#     0.00048593630803219975,
#     0.0004840211754157907,
#     0.00048294163927494783,
#     0.00048275537892970323,
#     0.0004835243283176187,
#     0.0004852364994678473,
#     0.0004878532240053298,
#     0.0004913159476828046,
#     0.0004955112269571012,
#     0.0005003677242612359,
#     0.0005057291009653332,
#     0.0005115475302648054,
#     0.0005176580411152178,
#     0.0005240659310258404,
#     0.0005306221111654481,
#     0.0005374078129605307,
#     0.0005443006510031951,
#     0.0005514644362508078,
#     0.0005588088146425921,
#     0.0005665791692785454,
#     0.0005747138413600122,
#     0.0005835335795756139,
#     0.0005930013358713716,
#     0.0006035069264124816,
#     0.0006150317839989008,
#     0.000628024199657207,
#     0.0006424841022344436,
#     0.0006589108945172662,
#     0.0006773202750193896,
#     0.0006982578323578344,
#     0.000721759212083074,
#     0.0007484164895029764,
#     0.0007782905293120031,
#     0.0008120189152849774,
#     0.0008496955734239378,
#     0.0008920033184906442,
#     0.0009390751401489022,
#     0.0009916369216233078,
#     0.0010498585757165828,
#     0.001114503962466198,
#     0.0011857767076220993,
#     0.001264470107651395,
#     0.0013508181162444517,
#     0.0014456328916346278,
#     0.0015491677416126885,
#     0.0016622430187332587,
#     0.0017851129010561049,
#     0.001918588372785102,
#     0.0020629091831653474,
#     0.002218867327122561,
#     0.0023866798021225065,
#     0.0025671243616627593,
#     0.002760406244815796,
#     0.002967312920591613,
#     0.0031880600853928607,
#     0.0034234690064160102,
#     0.003673786627564799,
#     0.0039398800790710255,
#     0.004222030422563548,
#     0.004521143036494287,
#     0.00483751753342429,
#     0.005172074392017098,
#     0.005525096748541656,
#     0.005897479663409037,
#     0.006289445016818921,
#     0.006701808869316128,
#     0.007134674330479514,
#     0.007588724259622067,
#     0.008063885902033666,
#     0.008560659202113092,
#     0.009078751211211485,
#     0.009618444817519674,
#     0.010179202760365415,
#     0.010761079681193778,
#     0.011363290155492502,
#     0.011985671994620754,
#     0.012627208759263087,
#     0.013287540820931736,
#     0.013965440773445408,
#     0.014660377525358242,
#     0.015370936017706088,
#     0.016096437187479818,
#     0.016835296622290465,
#     0.017586701928167525,
#     0.018348918694158306,
#     0.019121020187850064,
#     0.0199011372889397,
#     0.020688245790918706,
#     0.02148036715240006,
#     0.022276404465118946,
#     0.02307429432644223,
#     0.023872895454800105,
#     0.024670095560874593,
#     0.02546474517927067,
#     0.026254720886997096,
#     0.02703890074228899,
#     0.027815192484065263,
#     0.028582541684941645,
#     0.029338924982108834,
#     0.03008339089356954,
#     0.030814021141272224,
#     0.03152999803952329,
#     0.03222953534549458,
#     0.03291197119156591,
#     0.033575673541710774,
#     0.03422015065696753,
#     0.03484393628757457,
#     0.03544672054271089,
#     0.03602720999824431,
#     0.036585283695425165,
#     0.037119828466098785,
#     0.03763091885728323,
#     0.038117625692109705,
#     0.03858022564378279,
#     0.039017979456061606,
#     0.03943136764810287,
#     0.03981984070960364,
#     0.04018408427621382,
#     0.04052373344685051,
#     0.04083966824294819,
#     0.041131695671428624,
#     0.041400876805056316,
#     0.04164717043382284,
#     0.041871792741296945,
#     0.04207482865025841,
#     0.04225762111409315,
#     0.04242035079919472,
#     0.0425644555409469,
#     0.04269017986052708,
#     0.04279902469691074,
#     0.042891271057876074,
#     0.04296845859670233,
#     0.043030882470080814,
#     0.04308010199129539,
#     0.043116411045226996,
#     0.04314137753684808,
#     0.043155286589871444,
#     0.04315970693002689,
#     0.043154902080632815,
#     0.04314242848947226,
#     0.04312251007378398,
#     0.04309667091456951,
#     0.043065065821305065,
#     0.04302915896742487,
#     0.04298900694360162,
#     0.04294598716382489,
#     0.04290003404496431,
#     0.042852425005479616,
#     0.042802965998645,
#     0.04275283271838552,
#     0.04270171011079919,
#     0.04265068447479388,
#     0.042599333170458165,
#     0.04254867214683972,
#     0.04249818937512016,
#     0.042448841257065426,
#     0.04240004212652422,
#     0.04235270282157469,
#     0.04230617672833392,
#     0.04226133700503577,
#     0.042217486090920825,
#     0.0421754717529243,
#     0.04213455760429082,
#     0.042095575190549975,
#     0.04205775931477618,
#     0.04202193527289813,
#     0.04198731915430591,
#     0.04195473843231041,
#     0.04192339648977249,
#     0.04189412787720121,
#     0.04186612428122946,
#     0.041840227343309215,
#     0.04181561715682652,
#     0.04179314153268415,
#     0.041771964400776115,
#     0.04175293730343076,
#     0.04173520262446584,
#     0.041719612589843164,
#     0.04170528190890625,
#     0.041693058909059125,
#     0.04168202313939655,
#     0.04167301427610637,
#     0.041665071471487784,
#     0.041659024866090785,
#     0.04165387094626352,
#     0.0416504320827602,
#     0.04164766761011206,
#     0.04164640102271497,
#     0.04164556374481429,
#     0.04164599262554995,
#     0.04164660318746141,
#     0.04164825765337073,
#     0.04164986549265963,
#     0.041652321310717534,
#     0.04165453524743338,
#     0.04165743722295169,
#     0.041659940193998,
#     0.04166300963963593,
#     0.04166556284050431,
#     0.04166860157812333,
#     0.04167104964832035,
#     0.04167394635074288,
#     0.041676225343987156,
#     0.04167896592944238,
#     0.04168111074193078,
#     0.04168377673327941,
#     0.041685909764259975,
#     0.04168865763980678,
#     0.04169095776235507,
#     0.04169397526269337,
#     0.04169662461381239,
#     0.04170007871035143,
#     0.04170321590695633,
#     0.041707209684547546,
#     0.0417108984992374,
#     0.04171545567553317,
#     0.04171967572941791,
#     0.04172473557701465,
#     0.0417293880998105,
#     0.041734816657158044,
#     0.041739732022133415,
#     0.04174532962571261,
#     0.041750279463331694,
#     0.041755795741899304,
#     0.041760515644868074,
#     0.04176568612546048,
#     0.04176992275310497,
#     0.04177452107906739,
#     0.04177808673008037,
#     0.04178197525323847,
#     0.04178478878086571,
#     0.04178794360460729,
#     0.04179003385725616,
#     0.04179252681609062,
#     0.04179399646939312,
#     0.041795946400506864,
#     0.04179692103446607,
#     0.041798448095430096,
#     0.04179904110569366,
#     0.041800249422651106,
#     0.041800562302482955,
#     0.04180155522026307,
#     0.041801703564054334,
#     0.04180261256772355,
#     0.04180274736348262,
#     0.04180373649464338,
#     0.04180402666010158,
#     0.041805253195853403,
#     0.04180582444684951,
#     0.04180736493404926,
#     0.041808227507354995,
#     0.04181001771237987,
#     0.04181102900915375,
#     0.04181285772852611,
#     0.0418137511070457,
#     0.04181531906078194,
#     0.041815782649328365,
#     0.04181679114604349,
#     0.04181655832370301,
#     0.04181679071040732,
#     0.04181570437946655,
#     0.04181507117790639,
#     0.041813107678038156,
#     0.04181165062163035,
#     0.04180890960366146,
#     0.041806778953169955,
#     0.04180345218555337,
#     0.04180087698472783,
#     0.041797222806314066,
#     0.04179448594152667,
#     0.041790807783553055,
#     0.04178822921627602,
#     0.04178485188516336,
#     0.041782753110379434,
#     0.04177997854621121,
#     0.04177862297024473,
#     0.04177665688769046,
#     0.041776173484827414,
#     0.04177505129213341,
#     0.04177537567320189,
#     0.04177493585305177,
#     0.04177581411153373,
#     0.04177572920975707,
#     0.041776780657957244,
#     0.04177664203159308,
#     0.04177744851938528,
#     0.0417768525355795,
#     0.041777040102169205,
#     0.04177565891119025,
#     0.04177495725076538,
#     0.04177259049459418,
#     0.04177088429052776,
#     0.04176750951539877,
#     0.04176487915211051,
#     0.04176067860218838,
#     0.04175741517447622,
#     0.0417527719287329,
#     0.04174933838710626,
#     0.04174476074950351,
#     0.04174169060821775,
#     0.04173769821450021,
#     0.04173547520691382,
#     0.04173248633078956,
#     0.04173145337140466,
#     0.0417297139694671,
#     0.04173001495932125,
#     0.041729555922921456,
#     0.04173110677692405,
#     0.04173171673448339,
#     0.041734183204894804,
#     0.04173540833342817,
#     0.0417382350946915,
#     0.041739450078926904,
#     0.04174197839800498,
#     0.04174254044378607,
#     0.04174418621132528,
#     0.04174361675547659,
#     0.041744025218399,
#     0.0417421216440603,
#     0.041741229842770226,
#     0.04173807321348008,
#     0.041736075215605566,
#     0.04173197112408902,
#     0.04172924985042245,
#     0.04172466319688968,
#     0.04172174555714396,
#     0.04171727471181906,
#     0.04171481587654315,
#     0.041711160672882136,
#     0.041709878274530356,
#     0.04170772867515743,
#     0.04170823121798148,
#     0.04170803505235389,
#     0.04171056279908144,
#     0.04171228556394109,
#     0.041716527237430676,
#     0.041719570628978145,
#     0.04172470102200252,
#     0.04172805332032707,
#     0.041732972404768996,
#     0.04173550832340726,
#     0.041739159827782195,
#     0.041739947054896115,
#     0.041741595709698404,
#     0.04174012345469881,
#     0.04173952666524618,
#     0.041735820249156896,
#     0.04173328646880866,
#     0.04172790413783177,
#     0.041724220564832507,
#     0.04171811945748265,
#     0.04171436314592861,
#     0.04170866275328893,
#     0.04170593042687196,
#     0.04170163770805188,
#     0.041700785571298096,
#     0.041698558342944544,
#     0.04170000155576092,
#     0.041699998678338845,
#     0.04170361156521385,
#     0.04170544162030163,
#     0.04171055510890423,
#     0.04171331695793963,
#     0.041718825693277214,
#     0.04172129151456096,
#     0.04172590868057047,
#     0.041726843614277184,
#     0.04172948624810166,
#     0.0417280642121419,
#     0.04172824464666966,
#     0.041724352303779855,
#     0.041722348782900945,
#     0.04171659886039565,
#     0.04171330071710924,
#     0.04170674775438929,
#     0.04170330365828715,
#     0.04169709097929107,
#     0.04169458938129798,
#     0.0416896876987929,
#     0.041688961329529386,
#     0.04168601895036179,
#     0.04168750785959026,
#     0.04168670090982922,
#     0.04169029286294927,
#     0.04169117611262728,
#     0.04169610073955993,
#     0.04169759008586973,
#     0.04170254305225962,
#     0.041703210027159085,
#     0.04170679691643757,
#     0.04170540753008002,
#     0.04170668867811727,
#     0.041702667467561745,
#     0.04170146357745631,
#     0.04169502377259007,
#     0.04169189737959655,
#     0.04168392490251116,
#     0.04168001382880395,
#     0.04167187193227463,
#     0.04166867504294559,
#     0.041661935054507285,
#     0.041660946439706956,
#     0.041656895686058064,
#     0.04165902116867979,
#     0.041658061058567536,
#     0.04166311527735049,
#     0.04166447190780888,
#     0.04167117158802908,
#     0.041673177100234146,
#     0.04167965304737918,
#     0.041680394385067834,
#     0.041684871957350586,
#     0.0416828284860471,
#     0.04168418593202474,
#     0.04167869411755601,
#     0.04167681514292834,
#     0.04166828733673563,
#     0.041664114278757616,
#     0.04165388835353177,
#     0.04164906018025687,
#     0.04163888216672303,
#     0.041635136883389906,
#     0.041626591682798586,
#     0.04162531739377878,
#     0.04161954191685714,
#     0.04162162103180142,
#     0.0416191952080784,
#     0.04162483344686144,
#     0.0416254616877194,
#     0.04163372937734289,
#     0.041635753900351985,
#     0.0416443103000948,
#     0.04164491642250118,
#     0.04165090568298768,
#     0.04164768642366662,
#     0.04164965196802393,
#     0.04164233337263533,
#     0.041641197035427985,
#     0.041631578917281614,
#     0.04162961602089538,
#     0.04162000945280689,
#     0.04161929476034705,
#     0.04161140535622708,
#     0.041613299592806866,
#     0.041608201149506,
#     0.04161354889652646,
#     0.04161181379477204,
#     0.041620854861217235,
#     0.0416222648543922,
#     0.04163431903163939,
#     0.041637769994187016,
#     0.04165150212670188,
#     0.04165560566313914,
#     0.04166976118756176,
#     0.0416735058024031,
#     0.04168736889466737,
#     0.04169038219824152,
#     0.04170395850247251,
#     0.04170668224340497,
#     0.04172085750390073,
#     0.041724537178944435,
#     0.04174078081759343,
#     0.04174689457257234,
#     0.04176659667449846,
#     0.04177637639515419,
#     0.041800673550957346,
#     0.041815141058444055,
#     0.04184482412976262,
#     0.041864227943597676,
#     0.04189862189629802,
#     0.041921066950649004,
#     0.04195716386733417,
#     0.041979035810289986,
#     0.042013635113043304,
#     0.04203299542946744,
#     0.04206608094502981,
#     0.04208454416080552,
#     0.042118812312337155,
#     0.04213910666926407,
#     0.04217684722123022,
#     0.042200438811915306,
#     0.04224259458966309,
#     0.04226984534789392,
#     0.04231628875629923,
#     0.04234595526045855,
#     0.04239413499144792,
#     0.042422109225639756,
#     0.042467219927076014,
#     0.042488959764242745,
#     0.04252793990373795,
#     0.04254223185847276,
#     0.04257524823444543,
#     0.04258268516706942,
#     0.04260955792896723,
#     0.042608923373235505,
#     0.04262745351730573,
#     0.04261670038587003,
#     0.042625766995166924,
#     0.04260545587102506,
#     0.042606881027356616,
#     0.042578893444890825,
#     0.04257280001903312,
#     0.04253371044663903,
#     0.042512984844030745,
#     0.04245305980209081,
#     0.042408647130355914,
#     0.04232175406011389,
#     0.04225222259521039,
#     0.04214019441133042,
#     0.04204893604230128,
#     0.041913817017202634,
#     0.041800134499664666,
#     0.04163734065050341,
#     0.04149347742175588,
#     0.04129373022465289,
#     0.04111178671148542,
#     0.04087110972105773,
#     0.040651863944592664,
#     0.040374507589245885,
#     0.04012267397544653,
#     0.03981096990824242,
#     0.039525294249637195,
#     0.039174502128761696,
#     0.038848454175962666,
#     0.03845080708407603,
#     0.03807693753133315,
#     0.03762633589441211,
#     0.037202951072032184,
#     0.03670394281798699,
#     0.036241831934934826,
#     0.03570547207082872,
#     0.03520863178066677,
#     0.03462632006701831,
#     0.03408035669971493,
#     0.03344219037852475,
#     0.032849966715111076,
#     0.03216776829259453,
#     0.031541598935410406,
#     0.03082320996646138,
#     0.030166074205039025,
#     0.029412789050315857,
#     0.02872588494152753,
#     0.02794011272131719,
#     0.02722822028524756,
#     0.026413244092817374,
#     0.02567535893927509,
#     0.024825947545674854,
#     0.024066416016928646,
#     0.023197015675889485,
#     0.022431623537200268,
#     0.021544231403693603,
#     0.02076979731382672,
#     0.01986993549807105,
#     0.019107200631364337,
#     0.018218656677313066,
#     0.017488313616874314,
#     0.016622172960815376,
#     0.015919755602206244,
#     0.015046431554451975,
#     0.014325352955437562,
#     0.013418886805266542,
#     0.012713189353967284,
#     0.01187160718638567,
#     0.01128332762085607,
#     0.010524626893296689,
#     0.009963919304501665,
#     0.00916022386134135,
#     0.008576667169279493,
#     0.0078049446746371876,
#     0.007337713310037956,
#     0.006666003062347761,
#     0.006233473628882182,
#     0.005565325135154616,
#     0.0051856648846022,
#     0.004645326851960528,
#     0.0043425864603179425,
#     0.0037526363829516844,
#     0.0032975069121959737,
#     0.002910442252356026,
#     0.0028180717251945,
#     0.0024846233393324545,
#     0.0018328212767815821,
#     0.0018696633714326543,
#     0.0015620054417435202,
#     0.001247493316177125,
#     0.0011416267414707509,
#     0.0009297023545259686,
#     0.0007799859597351633,
#     0.0005379316843912556,
#     0.0005938601718133343,
#     0.00025947300653296305,
#     0.0004696112698550983,
# ]
# x0 = np.array(x0)
# solver._objective_state(x0)
# exit()


def calculate_taylor_remainders(solver, max_iter=30):
    energy = []
    grad_data["grad_norm"] = None
    state = solver._objective_state(x0)
    energy.append(solver._objective(state))
    grad = np.array(solver._jacobian(state))

    x = []
    y = []
    constant = 1.0e-1
    for i in range(1, max_iter):
        step_size = constant * 2.0 ** (-i)
        new_state = solver._objective_state(x0 + grad * step_size)
        energy.append(solver._objective(new_state))
        # remainders.append(energy[-1] - energy[0] - step_size * grad_data["grad_norm"])
        x.append(constant * 2.0 ** (-i))
        y.append(
            abs(energy[-1] - energy[0] - step_size * grad_data["grad_norm"]) / energy[0]
        )
    constant = 1.0e-6
    for i in range(1, max_iter):
        step_size = constant * 2.0 ** (-i)
        new_state = solver._objective_state(x0 + grad * step_size)
        energy.append(solver._objective(new_state))
        # remainders.append(energy[-1] - energy[0] - step_size * grad_data["grad_norm"])
        x.append(constant * 2.0 ** (-i))
        y.append(
            abs(energy[-1] - energy[0] - step_size * grad_data["grad_norm"]) / energy[0]
        )
    # for i, el in enumerate(remainders):
    #     x.append(constant * 2.0 ** (-i - 1))
    #     y.append(abs(el) / energy[0])
    return x[::-1], y[::-1]


run_taylor_test = False
if run_taylor_test:

    def piecewise_linear(x, x0, y0, k1, k2):
        return np.piecewise(
            x,
            [x < x0],
            [lambda x: k1 * x + y0 - k1 * x0, lambda x: k2 * x + y0 - k2 * x0],
        )

    # c = np.arange(0, 12)  # 4, 12, 2
    c = np.arange(100, 3320, 50)
    for iterations in c[::-1]:
        initial_resolution = 100 + iterations  # * 2 ** iterations  # iterations
        domain = IntervalDomain([p1, p2], resolution=initial_resolution)
        cut = 0.8
        # domain.mesh = resolve_mesh(domain.mesh, iterations=iterations, cut=cut)
        print("num cells: ", domain.mesh.num_cells())
        # domain.mesh = resolve_mesh(domain.mesh, 4, cut=1.0 - 0.1 * iterations)
        solver = OptimizationSolver(domain, Re=5.0e3, Pr=10.0, timer=timer)

        x, y = calculate_taylor_remainders(solver, max_iter=14)
        with open("taylor_state_uniform_T_01_dt_0001.dat", "a") as file:
            # file.write(
            #     str((1.0 - cut) / (domain.mesh.num_cells() - initial_resolution * cut))
            #     + "\n"
            # )
            file.write(str(1.0 / domain.mesh.num_cells()) + "\n")
            # file.write(str(float(timer["dt"])) + "\n")
            file.write(",".join(map(str, x)))
            file.write("\n")
            file.write(",".join(map(str, y)))
            file.write("\n")

    exit()

solver.optimization_method = "TNC"
res = solver.minimize(x0, bnds)

import matplotlib.pyplot as plt

plt.plot(res.x)
plt.show()
